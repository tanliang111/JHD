<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"><html><!-- InstanceBegin template="/Templates/guide-template.dwt" codeOutsideHTMLIsLocked="false" --><head><!-- InstanceBeginEditable name="doctitle" --><title>JHotDraw: Implement a new Figure</title><!-- InstanceEndEditable --><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1"><script language="JavaScript" type="text/JavaScript"><!--function MM_reloadPage(init) {  //reloads the window if Nav4 resized  if (init==true) with (navigator) {if ((appName=="Netscape")&&(parseInt(appVersion)==4)) {    document.MM_pgW=innerWidth; document.MM_pgH=innerHeight; onresize=MM_reloadPage; }}  else if (innerWidth!=document.MM_pgW || innerHeight!=document.MM_pgH) location.reload();}MM_reloadPage(true);//--></script><!-- InstanceBeginEditable name="head" --><!-- InstanceEndEditable --><link href="../style.css" rel="stylesheet" type="text/css"></head><body><div id="contentLayer" style="position:absolute; left:280px; top:70px; bottom:0px; right:0px; z-index:1; overflow: auto;"><div style="padding-right:20px;"><!-- InstanceBeginEditable name="contentRegion" -->  <p class="spacingNone">In this tutorial we develop a figure that draws a straight    line. You can find the source code of the StraightLineFigure class in the    package org.jhotdraw.samples.mini.</p>  <p class="spacingNone">&nbsp;</p>  <p class="spacingNone">This tutorial consist of the following steps:</p>  <p class="spacingNone">Step 1: <a href="#interfaces">Check for interfaces</a></p>  <p class="spacingNone">Step 2: <a href="#existingcode">Check for existing code</a></p>  <p class="spacingNone">Step 3: <a href="#skeleton">Write a skeleton class</a></p>  <p class="spacingNone">Step 4: <a href="#drawmethods">Implement the draw methods</a></p>  <p class="spacingNone">Step 5:<a href="#boundsmethods"> Implement the bounds methods</a></p>  <p class="spacingNone">Step 6: <a href="#transformmethods">Implement the transform methods</a></p>  <p class="spacingNone">Step 7: <a href="#containsmethods">Implement the contains method</a></p>  <p class="spacingNone">Step 8: <a href="#clonemethod">Implement the clone method</a></p>  <p class="spacingNone">&nbsp;</p>  <h2 class="spacingNone"><a name="interfaces"></a>Step 1: Check for interfaces</h2>  <p class="spacingNone">Before you start creating    a new Figure class for the JHotDraw framework, you should take a look at    the &#8249;All    Known Subinterfaces&#8250;    list    and the &#8249;All Known Implementing Classes&#8250; list in the <a href="../../javadoc/org/jhotdraw/draw/Figure.html">JavaDoc    documentation of the Figure interface</a>.</p>  <p class="spacingNone">&nbsp;</p>  <p class="spacingNone">In the &#8249;All Known Subinterfaces&#8250; list    you  find interfaces that cover specialized feature sets of Figure objects.</p>  <ul>    <li>Your figure should implement the <a href="../../javadoc/org/jhotdraw/draw/CompositeFigure.html">CompositeFigure</a> interface,      if the figure is composed from multiple child figures. For example, if      the Figure shall provide multiple text fields for text entry, like <a href="../../javadoc/org/jhotdraw/samples/pert/figures/TaskFigure.html">TaskFigure</a>      in the Pert sample application.</li>    <li>Your figure should implement the <a href="../../javadoc/org/jhotdraw/draw/ConnectionFigure.html">ConnectionFigure</a> interface,      if it is used to connect other figures. In this case you will most likely      be able to subclass your figure from <a href="../../javadoc/org/jhotdraw/draw/LineConnectionFigure.html">LineConnectionFigure</a> or from <a href="../../javadoc/org/jhotdraw/draw/LabeledLineConnectionFigure.html">LabeledLineConnectionFigure</a>      as these classes provide already a rich feature set for connection figures.</li>    <li>Your figure should implement the <a href="../../javadoc/org/jhotdraw/draw/ImageHolderFigure.html">ImageHolderFigure</a> or the <a href="../../javadoc/org/jhotdraw/draw/TextHolderFigure.html">TextHolderFigure</a>      interfaces or even both of them, if the figure holds an image or a text      that shall be editable using the drawing editor.</li>  </ul>  <p>For this tutorial, we don't need to use any of these specialized interfaces,    because we just want to draw a straight line.</p>  <h2 class="spacingNone">&nbsp;</h2>  <h2 class="spacingNone"><a name="existingcode"></a>Step 2: Check for existing code</h2>  <p>In the &#8249;All Known Implementing Classes&#8250; list of the Figure interface     you find abstract classes that you can use as building blocks for your own  figure class.</p>  <p>Maybe you find a default implementation of the Figure interface      here, that saves you the time from writing your own figure from scratch.      For example, there is no need for you to implement a RectangleFigure by    yourself, because this class is already there. at least, you may find sample      implementations of the Figure interface, that you can use as a copy and    paste    source for your own figure.</p>  <p class="spacingNone">&nbsp;</p>  <p class="spacingNone">If it weren't for this tutorial, we could just use the    existing <a href="../../javadoc/org/jhotdraw/draw/LineFigure.html">LineFigure</a>    class    and go all home now. But today, we wan't to do it the hard way, so&#8230;</p>  <p class="spacingNone">&nbsp;</p>  <p class="spacingNone">&#8230;lets take      a look at the abstract classes that the JHotDraw framework provides:</p>  <ul>    <li>Ideally, your Figure should subclass from one of the existing Figure          classes that implements one of the Interfaces that we have listed above.      Good candidates for subclassing are:      <ul>        <li><a href="../../javadoc/org/jhotdraw/draw/AbstractAttributedFigure.html">AbstractAttributedFigure</a></li>        <li><a href="../../javadoc/org/jhotdraw/draw/AbstractAttributedCompositeFigure.html">AbstractAttributedCompositeFigure</a></li>        <li><a href="../../javadoc/org/jhotdraw/draw/AbstractCompositeFigure.html">AbstractCompositeFigure</a></li>        <li><a href="../../javadoc/org/jhotdraw/draw/GraphicalCompositeFigure.html">GraphicalCompositeFigure</a></li>        <li><a href="../../javadoc/org/jhotdraw/draw/LineConnectionFigure.html">LineConnectionFigure</a></li>        <li><a href="../../javadoc/org/jhotdraw/draw/LabeledLineConnectionFigure.html">LabeledLineConnectionFigure</a></li>      </ul>    </li>    <li>If none of these are suitable, your figure should by all means subclass        from <a href="../../javadoc/org/jhotdraw/draw/AbstractFigure.html">AbstractFigure</a>.        Because this class contains all the boilerplate code that you need to implement        anyway. The only reason not to subclass from AbstractFigure, is if you        need to maintain another class hierarchy. If this is the case, you should        try first, if you can use the <a href="../pattlets/02_observer.html">Observer        design pattern</a>, letting AbstractFigure        acting as an observer of your other object.</li>  </ul>  <p>For our StraightLineFigure, we will subclass from AbstractAttributedFigure.</p>  <h2><a name="skeleton"></a>Step 3: Write a skeleton class</h2>  <p>An IDE can generate    all the empty methods for us. All we need to do, is to choose the class    we want to extend from. Here is the skeleton code  we get from NetBeans,    when creating an empty class named StraightLineFigure that extends from AbstractAttributedFigure:</p>  <pre>import java.awt.*;<br>import java.awt.geom.*;<br>import org.jhotdraw.draw.*;<br><br>public class StraightLineFigure extends AbstractAttributedFigure {<br>    protected void drawFill(Graphics2D g) {}<br>    protected void drawStroke(Graphics2D g) {}<br>    public void basicSetBounds(Point2D.Double start, Point2D.Double end) {}    public Rectangle2D.Double getBounds() {}<br>    public void basicTransform(AffineTransform ty) {}<br>    public Object getTransformRestoreData() { return null; }<br>    public void restoreTransformTo(Object restoreData) {}<br>    public boolean contains(Point2D.Double p) { return false; }<br>}</pre>   <h2><a name="drawmethods"></a>Step 4: Implement  the draw methods</h2>  <p>The draw methods are used to render a Figure onto a Graphics2D object. The    Graphics2D object serves as the canvas for the Figure.</p>  <p>Since we decided to      subclass from AbstractAttributedFigure in Step 2, we do not need to configure    the Graphics2D object.      AbstractAttributedFigure applies all attributes of the Figure to the Graphics2D      object before it invokes the drawFill and the drawStroke methods. Thus    we do not need to write any code that sets the color, stroke or paint of    the      Graphics2D object.</p>  <p>In order to draw a straight line, we can use a Line2D.Double object from    the java.awt.geom package.</p>  <ul>    <li>We create an instance variable named <code>line</code> that holds the      line object.</li>    <li>Then we create a constructor, that creates a Line2D.Double instance.</li>    <li>We can leave the drawFill method empty, because we don't want do fill      the line.</li>    <li>In method drawStroke, we draw the line onto the Graphics2D object.</li>  </ul>  <p>Here is the resulting code:</p>  <pre>public class StraightLineFigure extends AbstractAttributedFigure {    private Line2D.Double line;    <br>    public StraightLineFigure() {<br>        line = new Line2D.Double();<br>    }    protected void drawFill(Graphics2D g) {		// empty	}<br>    protected void drawStroke(Graphics2D g) {        g.draw(line);	}    &#8230;<br>}</pre>  <h2><a name="boundsmethods"></a>Step 5: Implement the bounds methods</h2>  <p>The bounds methods are used by <a href="../../javadoc/org/jhotdraw/draw/Tool.html">Tool</a> objects    to manipulate the Figure. They also allow to programatically change the bounds    of a Figure.</p>  <p>&nbsp;</p>  <pre>public class StraightLineFigure extends AbstractAttributedFigure {    private Line2D.Double line;    <br>    public void basicSetBounds(Point2D.Double start, Point2D.Double end) {        line.setLine(start, end);<br>    }<br>    public Rectangle2D.Double getBounds() {<br>        return (Rectangle2D.Double) line.getBounds2D();<br>    }	&#8230;<br>}</pre>  <h2><a name="transformmethods"></a>Step 6: Implement the transform methods</h2>  <p>The transform methods are used by some <a href="../../javadoc/org/jhotdraw/draw/Handle.html">Handle</a> objects    to manipulate the Figure.</p>  <p>The  basicTransform method performs the transformation, by transforming    the two end points of the line object using the passed AffineTransform object    from the java.awt API.</p>  <p>The getTransformRestoreData and restoreTransformTo methods are used to provide    (near) lossless transformation and to provide undo functionality. Before    a Handle transforms the Figure the first time, it retrieves an object from    method getTransformRestoreData. Method restoreTransformTo is used by the    Handle    to restore the original transformation    of the Figure whenever this is needed.</p>  <p>In our implementation we return a clone of the line in method getTranformRestoreData.    In method restoreTransformDataTo, we set the line to yet another clone of    the restored data.</p>  <pre>public class StraightLineFigure extends AbstractAttributedFigure {    private Line2D.Double line;    <br>    public void basicTransform(AffineTransform ty) {<br>        Point2D.Double p1 = (Point2D.Double) line.getP1();<br>        Point2D.Double p2 = (Point2D.Double) line.getP2();<br>        line.setLine(<br>                ty.transform(p1, p1),<br>                ty.transform(p2, p2)<br>                );<br>    }<br>    public Object getTransformRestoreData() {<br>        return line.clone();<br>    }<br>    public void restoreTransformTo(Object restoreData) {<br>        line = (Line2D.Double) ((Line2D.Double) restoreData).clone();<br>    }    &#8230;<br>}</pre>  <h2><strong><a name="containsmethods"></a>Step 7: Implement the contains method</strong></h2>  <p>The contains method is used by Tool objects to perform hit tests on the    Figure, for example to determine on which Figure a mouse click was performed.</p>  <p>Altough, class Line2D.Double already provides a contains method, we use     the contains method of the org.jhotdraw.geom.Geom class. This method allows    us to pass in the total width of the line using the tolerance parameter.</p>  <pre>public class StraightLineFigure extends AbstractAttributedFigure {    private Line2D.Double line;    <br>    public boolean contains(Point2D.Double p) {<br>        return Geom.lineContainsPoint(<br>                line.x1,line.y1,<br>                line.x2, line.y2,<br>                p.x, p.y, <br>                AttributeKeys.getStrokeTotalWidth(this));<br>    }<br>    &#8230;<br>}</pre>  <h2><strong><a name="clonemethod"></a>Step 8: Implement the clone method</strong></h2>  <p>The JHotDraw framework uses cloning for creating new objects. It is very    important that the clone method of a Figure is properly implemented, or we    will encounter problems, if more of one StraigthLineFigure object is in a    Drawing.</p>  <pre>public class StraightLineFigure extends AbstractAttributedFigure {    private Line2D.Double line;    <br>    public StraightLineFigure clone() {<br>        StraightLineFigure that = (StraightLineFigure) super.clone();<br>        that.line = (Line2D.Double) this.line.clone();<br>        return that;<br>    }	&#8230;<br>}</pre>  <h2><strong></strong></h2>  <p>&nbsp;</p>  <p>&nbsp;</p>  <p>&nbsp;</p>  <p>&nbsp;</p>  <p>&nbsp;</p>  <p>&nbsp;</p><!-- InstanceEndEditable --></div></div><div id="tocLayer" style="position:absolute; left:20px; top:71px; width:220px; height:220px; z-index:2; overflow: auto;"><!-- InstanceBeginEditable name="tocRegion" --><iframe id="tocFrame" src="../toc.html" width="200" height="200" scrolling="no"></iframe><!-- InstanceEndEditable --></div><div id="subtocLayer" style="position:absolute; left:20px; top:312px; width:220px; bottom:0px; z-index:2; overflow: auto;"><!-- InstanceBeginEditable name="subtocRegion" --><iframe id="subtocFrame" src="subtoc.html" width="200" height="400" scrolling="auto"></iframe><!-- InstanceEndEditable --></div><div id="Layer2" style="position:absolute; left:280px; top:10px; right:0px; height:40px; z-index:3"><!-- InstanceBeginEditable name="titleRegion" -->  <h1> How to implement a new Figure</h1><!-- InstanceEndEditable --></div><div id="logoLayer" style="position:absolute; left:20px; top:10px; width:220px; height:50px; z-index:4">  <h1>JHotDraw 7</h1></div><div id="verticalDivider" style="position:absolute; left:240px; top:0px; width:20px; bottom:0px; z-index:5"></div></body><!-- InstanceEnd --></html>